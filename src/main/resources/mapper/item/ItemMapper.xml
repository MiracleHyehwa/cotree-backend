<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.futurenet.cotree.item.repository.ItemRepository">

    <select id="findItemsByCategory" resultType="com.futurenet.cotree.item.dto.ItemDto">
        SELECT I.ID, I.CATEGORY_ID, I.NAME, I.PRICE, I.ORIGIN, I.DISCOUNT, I.IS_GREEN AS isGreen, I.THUMBNAIL_IMAGE as thumbnailImage, B.NAME AS brandName
        FROM ITEM I
        JOIN BRAND B ON I.BRAND_ID = B.ID
        <where>
            <if test = "categoryId != 0">
                I.CATEGORY_ID = #{categoryId}
            </if>
        </where>
    </select>

    <update id="decreaseStock">
        UPDATE item
        SET quantity = quantity - #{quantity}
        WHERE id = #{itemId} AND quantity >= #{quantity}
    </update>
</mapper>